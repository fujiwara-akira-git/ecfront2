# Refactor Plan

目的:
- コードの可読性と保守性を高める。
- 配送プロバイダ周りを整理し、本番/テスト切替を環境変数で簡単に管理できるようにする。
- ドキュメントを整備して今後の作業をスムーズにする。

優先度:
1. 安全な小変更（ドキュメント、環境変数 centralization）
2. モジュール分割（`lib/delivery` の整理、`lib/config.ts` の導入）
3. API ルートの整理（`app/api/delivery/*`）
4. E2E テストと CI の導入（別タスク）

受け入れ基準:
- 主要ユースケース (`/api/delivery/rates`, `/api/delivery/create`) が動作すること
- Prisma クエリ動作に影響がないこと
- ドキュメントが `docs/` に作成され、`README.md` にリンクがあること

実施ステップ:
1. `docs/` の作成（本ファイルを含む）
2. 環境変数アクセスを集中する `lib/config.ts` を検討（軽量）
3. `lib/delivery/providers` のエントリポイントと型定義の見直し
4. 不要な `.next` キャッシュやビルド成果は .gitignore に委ねる（自動化）
5. 実 API の応答スキーマが手に入り次第、providers のレスポンスパースを厳密化

リスクと緩和策:
- 大きなリファクタは本番障害のリスクがあるため段階的に行う。まずドキュメントと小さな抽象化から。
